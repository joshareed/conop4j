apply plugin: 'eclipse'
apply plugin: 'java'

sourceCompatibility = 1.5
targetCompatibility = 1.5
version = '0.2'
group = 'org.andrill.conop'

manifest.mainAttributes(
	'Implementation-Title': 'CONOP Post Processor',
	'Implementation-Version': version,
	'Main-Class': 'org.andrill.conop.pp.PostProcess'
)

repositories {
	mavenCentral()
}

dependencies {
	compile 'com.google.guava:guava:r06'
	compile 'org.apache.poi:poi:3.6'
	compile 'org.apache.poi:poi-ooxml:3.6'
	compile 'net.sf.jopt-simple:jopt-simple:3.2'
	compile 'com.miglayout:miglayout:3.7.3.1'
	testCompile 'junit:junit:4.4'
}

task release(dependsOn: configurations.default.buildArtifacts) << {
	def dest = file("$buildDir/fatjar")
	dest.mkdirs()
	
	// expand all our dependencies
	configurations.compile.each { jar ->
		ant.unzip(src: jar, dest: dest, overwrite: true)
	}
	
	// expand our code
	configurations.default.allArtifactFiles.each { jar ->
		ant.unzip(src: jar, dest: dest, overwrite: true)
	}
	
	// create our fatjar
	mkdir("$buildDir/release")
	ant.zip(destfile: "$buildDir/release/${project.name}-${version}.jar", basedir: dest)
}
