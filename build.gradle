apply plugin: 'java'
apply plugin: 'groovy'
apply plugin: 'eclipse'

sourceCompatibility = 1.7
targetCompatibility = 1.7
version = '0.8.1'
group = 'org.andrill.conop'

manifest.mainAttributes(
	'Implementation-Title': 'CONOP Tools',
	'Implementation-Version': version,
	'Main-Class': 'org.andrill.conop.ui.CONOPTools'
)

repositories {
	mavenCentral()

	maven { url "http://oss.sonatype.org/content/repositories/snapshots/" }
}

dependencies {
	compile 'com.google.guava:guava:14.0.1'
	compile 'net.sf.opencsv:opencsv:2.3'
	compile 'org.apache.poi:poi:3.7'
	compile 'org.apache.poi:poi-ooxml:3.7'
	compile 'net.sf.jopt-simple:jopt-simple:3.2'
	compile 'com.miglayout:miglayout:3.7.4:swing@jar'
	compile 'com.fasterxml.jackson.core:jackson-core:2.0.0'

	testCompile "org.codehaus.groovy:groovy-all:2.1.3"
	testCompile "org.spockframework:spock-core:1.0-groovy-2.0-SNAPSHOT"
}

task release(dependsOn: configurations.default.allArtifacts) << {
	def dest = file("$buildDir/fatjar")
	dest.mkdirs()

	// expand all our dependencies
	configurations.compile.each { jar ->
		ant.unzip(src: jar, dest: dest, overwrite: true)
	}

	// expand our code
	configurations.default.allArtifacts.files.each { jar ->
		ant.unzip(src: jar, dest: dest, overwrite: true)
	}

	// create our fatjar
	mkdir("$buildDir/release")
	ant.zip(destfile: "$buildDir/release/conop-tools-${version}.jar", basedir: dest)
}

task wrapper(type: Wrapper) {
	gradleVersion = '1.7'
	jarFile = 'wrapper/wrapper.jar'
}